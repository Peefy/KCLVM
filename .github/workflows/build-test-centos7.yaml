name: Build and Test on centos7 amd64

on: ["push", "pull_request"]

jobs:
  build-and-test-centos7:
    name: Build and Test on Linux ARM64
    runs-on: ubuntu-latest
    container: kcllang/kcl-builder:centos7
    steps:
      - name: Check out code
        uses: actions/checkout@v3
        with:
          submodules: "true"

      - name: Run custom ARM64 Docker image
        run: |
          source ~/.bash_profile
          cat ~/.bash_profile
          export PATH=$PATH:/opt/build/bin && sed -i '' 's/llvm12/llvm7/g' kclvm/compiler/Cargo.toml
          make && make release

      - name: Upload Artifact
        uses: actions/upload-artifact@v3
        with:
          name: kcl-centos7-amd64
          path: _build/dist/centos/kclvm
